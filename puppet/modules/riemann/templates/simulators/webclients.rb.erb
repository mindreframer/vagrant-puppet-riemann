#!/usr/bin/env ruby
require 'rubygems'
require 'riemann/client'

@client = Riemann::Client.new

SERVERS = ["www1", "www2", "www3", "worker1", "worker2", "worker3"]
def send_stuff
  metric = rand(5000)/100.0
  state  = metric < 20 ? "ok" : (metric > 40 ?  "critical" : "warning")
  @client << {
    :host        => SERVERS[rand(SERVERS.size)],
    :service     => "http req",
    :metric      => metric,
    :state       => state,
    :description => "Request took #{metric} seconds.",
    :tags        => ["prod", "webserver"]
  }
end

10000.times do
  send_stuff
  sleep 0.1
end